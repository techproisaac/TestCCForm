<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Register Card</title>

<style>
    body {
        background: #0d1117;
        color: #fff;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }

    .container {
        max-width: 420px;
        margin: auto;
        background: #161b22;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    h2 {
        margin-top: 0;
        text-align: center;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
        position: relative;
    }

    label {
        display: block;
        margin-bottom: 6px;
        font-size: 15px;
    }

    input {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #30363d;
        background: #0d1117;
        color: #fff;
        font-size: 16px;
    }

    .card-logo {
        width: 50px;
        position: absolute;
        right: 10px;
        top: 36px;
    }

    button {
        width: 100%;
        padding: 12px;
        background: #238636;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        color: white;
        margin-top: 10px;
    }

    #modal, #finalMessage {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.85);
        display: none;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 20px;
    }

    #modalContent, #finalContent {
        background: #161b22;
        padding: 25px;
        border-radius: 12px;
        max-width: 350px;
        width: 100%;
    }

    .spinner {
        border: 4px solid #444;
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin: 0 auto 15px auto;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        100% { transform: rotate(360deg); }
    }
</style>
</head>

<body>
<div class="container">
    <h2>Register your Card</h2>

    <form id="cardForm">
        <div class="form-group">
            <label>Card Number</label>
            <input id="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456" required />
            <img id="brandLogo" class="card-logo" style="display:none;" />
        </div>

        <div class="form-group">
            <label>Expiration (MM/YY)</label>
            <input id="expiry" maxlength="5" placeholder="MM/YY" required />
        </div>

        <div class="form-group">
            <label>CVV</label>
            <input id="cvv" maxlength="4" placeholder="123" required />
        </div>

        <button type="submit">Submit</button>
    </form>
</div>

<!-- PROCESSING MODAL -->
<div id="modal">
    <div id="modalContent">
        <div class="spinner"></div>
        <h3>Please hold...</h3>
        <p>Registering your card.</p>
    </div>
</div>

<!-- FINAL MESSAGE MODAL -->
<div id="finalMessage">
    <div id="finalContent">
        <h3>Card Registered Successfully</h3>
        <p>Your information has been submitted.</p>
        <br>
        <p><b>You may now close this window to return to the chat.</b></p>
        <p style="font-size:14px; opacity:0.7;">
            In Comm100 you’ll see two ‘X’ buttons:<br><br>
            • <b>Top-right X</b> closes the entire chat.<br>
            • <b>Lower X</b> closes only this card form window.<br><br>
            Please click the **lower X** to return to the chat.
        </p>
    </div>
</div>

<script>
// BRAND LOGIC
const cardInput = document.getElementById("cardNumber");
const brandLogo = document.getElementById("brandLogo");

cardInput.addEventListener("input", () => {
    let num = cardInput.value.replace(/\D/g, "");

    // format XXXX XXXX XXXX XXXX
    cardInput.value = num.replace(/(.{4})/g, "$1 ").trim();

    // detect card type
    let brand = "";
    if (/^4/.test(num)) brand = "visa";
    else if (/^5[1-5]/.test(num)) brand = "mastercard";
    else if (/^3[47]/.test(num)) brand = "amex";

    if (brand === "visa") {
        brandLogo.src = "https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png";
        brandLogo.style.display = "block";
    } else if (brand === "mastercard") {
        brandLogo.src = "https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg";
        brandLogo.style.display = "block";
    } else if (brand === "amex") {
        brandLogo.src = "https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo_%282018%29.svg";
        brandLogo.style.display = "block";
    } else {
        brandLogo.style.display = "none";
    }
});

// EXPIRY FORMAT MM/YY
document.getElementById("expiry").addEventListener("input", (e) => {
    let v = e.target.value.replace(/\D/g, "");
    if (v.length >= 3) v = v.slice(0,2) + "/" + v.slice(2,4);
    e.target.value = v;
});

// CVV restriction already handled by maxlength

// FORM SUBMISSION
document.getElementById("cardForm").addEventListener("submit", function(e){
    e.preventDefault();

    document.getElementById("modal").style.display = "flex";

    // 5 second simulated upload
    setTimeout(() => {
        document.getElementById("modal").style.display = "none";
        document.getElementById("finalMessage").style.display = "flex";
    }, 5000);
});
</script>

</body>
</html>
